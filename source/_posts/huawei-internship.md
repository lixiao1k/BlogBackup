---
layout: post
title: "菊廠實習日記"
date: 2018-07-16 14:48
comments: true
tags: 
	- 日記
---

> 作為民族先鋒企業，它飽受爭議，民間對於它的傳聞數不勝數，有積極的，必然也有消極的。對它的愛恨情仇交織在一起，構建起我們每個人心中那個獨特的菊廠…

<!-- more -->



#### 07-13

**星期五 晴**

今天是計劃入職的時間，學院的考試也在昨日恰巧結束。

菊廠給人的第一印象就是很大，環境很優美，D區入門辨識度最高的就是一幢包豪斯風格的N5大樓，一種簡單、穩重、實用的氣息瀰漫在空中。

如果把門口的標牌換成某個大學的名字，甚至沒有人會懷疑它不是一所高等學府。

入職第一天就是培訓，上午是HR小姐姐的吧啦吧啦講解，不是很重要的，重要的是小姐姐特別美麗大方。

下午是比較重要的信息安全培訓，前輩著重強調了公司的各項信息安全規定和相關懲罰制度。公司信息安全特別重要，尤其是對於大體量世界級別的高科技企業。具體內容也不必要展開了，反正在我這種沒見過世面的人眼裡，這種安全等級制度就像在做國家機密項目一般嚴格。

下午我們便被領到相應的部門，見相應的導師。然而這裡很不幸的碰到了一點小問題，我居然被分到了一個做安卓的部門，而不是起初意向的大數據，所以在見到導師的那一刻，我就申請調崗。菊廠這裡做的還是很人性化的，他們了解到我的需求和學術背景後便積極幫我協調換崗，做安卓的應用市場部門主管甚至還打電話給HR說當初調崗為什麼不把同學的背景了解清楚😅。不管怎麼說，過程碰到了一些小曲折，但是菊廠的人性化以及前輩們的熱心給我的初次印象是很棒的，這至少已經消除了來之前的一些疑慮，同時也證明了外界言論的偏見性，這其實也是我來菊廠的一大理由，對於所有的傳言，我要切身體會證實，真則真，假則假，真假不真，真假不假，真假則真假（能理解這句話的給你個讚，不過切實不是瞎寫的）。



#### 07-16

**星期一 晴**

今天是正式工作的第一天，我們幾個實習生八點就來到了公司，然而，公司居然並沒有幾個研發人員到崗！菊廠採用的是彈性工作制，早上八點到九點到都是可以的，但是必須保證一天的工時滿八小時。只是，我們天真地都在八點到了，還是嫩了點呢。

一早我就要去大數據部門報到，重新協調工作內容和導師。

先是大數據部門的主管來見我，向我介紹了本門業務的整個架構，然後get到我的興趣點後，將對應的部門分主管喊來繼續在相應部門深入介紹，然後繼續更精確地get到我的興趣點，最後根據我的興趣點分配了我的導師。

考慮到職業路線的規劃，我選擇的是離線計算平台，主要內容有Hive Spark MR HBase，而沒有選擇我更熟悉的惡數據倉庫部分。

師父（導師）是一個長得萌萌噠的中年？男性，話不多，典型的IT男的樣子，但是很和藹，一看就是沒脾氣的那種人。由於我們部門的幾位沒能協調及時，我讚時還沒有台式機，所以師父就帶我去接了便攜機，隨便去設置了域帳號，以及完成系列入職相關的準備工作。

然後拋來一本厚厚的Hadoop，沒錯，這就是我要在最近要完成的學習內容。

我們部門的技術會議都是會讓我們兩個實習生參加的，不僅僅是我的師父，其他的部門成員在召集人員開會時都會特地來和我倆實習生一起去，據我了解，好像還沒有那個部門這麼做。

聽技術大拿討論技術簡直就是一種享受，那種平和而紳士的討論氛圍，以及那種英雄所見略同的思維共驅性，使我這個旁聽者身心舒暢。大拿們討論的內容是十分難懂的，當然處處都是乾貨，要不是我有一些相關的知識基礎，可能連他們在講什麼都聽不懂，另外一個我們院的實習生，因為本科階段不是南大的，沒有上過商務智能的課，所以他一開始很難聽懂。

今天可能是特殊原因，比如週一？，上下午都開了技術會議，上午接近2小時，下午接近3小時，兩次都拖過了飯點，餓啊啊啊。下午的會議從3:00開到了6:20，前大部分討論十分高效，我認為比在學校聽課是強多了的，然而5:30之後會議的效率開始下降，個人覺得拖過飯點顯得有些不必要了。

晚上7點半左右到宿舍，很累，應該還沒怎麼適應這種節奏吧。

#### 07-17 深夜

**星期二 晴**

今天嘗試使用了手機打卡。

今天的主要任務還是學習，嘗試掌握新知識並且了解業務細節是非常痛苦的過程，因為它的學習曲線是很陡峭的，沒有人會叫你從零開始一步步嘗試，我們必須迅速達到業務技術高度，才能於正式員工的工作對接上。困難很多，但是我相信咬咬牙很快都會過去的。

上午主要在學習Hadoop，然後發現自己的iAccess權限失效了，可能是因為換崗的原因，技術支持那邊沒有協調好，所以花了一些時間在權限申請上。

下午師父發了菊廠大數據平台FusionInsight HD的技術文檔，需要學習一遍，文檔雖然是中文的，但是很深，目前所看到的部分基本上都是架構層面的，比較抽象，學起來效率也比較低，其實有點小著急 ，但是學習是需要過程的。

最後一小時，和小組進行了視頻會議，大佬們在討論業務任務，指定計劃。伟民那時候準備找我吃飯，然後在espace上看到我的狀態是會議中😢，以後這種情況應該不會少見，每個部門的實習生的具體工作情況都是不同的，但交流下來發現他們都很比較累的。龍兄在上海攜程工作，9:30時他發了一張凌空SOHO夜晚燈火通明的照片並附文：今天提前下班了。想到這，不免有些小慶幸訥。

回家的路上碰到了飄飄，飄飄講述了她的工作內容和工作方式，她所在的本門是視頻，所做的活還是和我們有很大的區別的。飄飄說，他們部門氛圍很好，吃完飯還一起打了會兵乓。這樣比較下來，我們部門目前看來好像並沒有這樣的活動呢。我順便邀請了飄飄以後可以一起打球，反正打得都很差，這樣才玩得起來嘛😂。

#### 07-18 夜

**星期三 晴**

今天去得比較早，8點就打了卡。

上午師父終於幫我接到了一台顯示器，雖然不是新的台式機，但是有顯示器已經比之前強多了。

今天的主要工作還是看FI文檔，這些文檔是真的多。領顯示器的時候，師父交代了我最近需要完成的任務：FusionInsight MetaStore 的負載均衡，需要在8月1上交測試組，任務還是比較急的。師父本來準備下午找人來介紹一下相關知識的，但是後來估計是比較忙，師父把這事給忘了。我就自己在那看了一些相關知識，喔對了，外網訪問權限還沒申好，瀏覽網頁很不方便。

今天中午趴在桌子上睡了一會，腰酸背疼，還著了涼，醒來二話不說就買了張床，以後打算就在公司睡折疊床了。

下午讓在學校準備考研的一哥幫忙買了一箱牛奶，晚上回去校超關門了很不方便，順便讓一哥拿了個快遞，一本Hadoop權威指南到了，這是一本磚頭書，整整一百塊，心疼。

晚上5:30我準時溜了，畢竟環境沒搭好，活也幹不了。



#### 07-19 夜

**星期四 晴**

今天代碼下發下來了。師父先是把整個FusionInsight_Dive的源代碼發給我說讓我看，kidding me？這可是無窮盡的代碼啊，師父居然也沒有說什麼讀源碼的線路。。。

後來師父請來了王迪同事為我們講了一下需要修改的java類已實現metastore的負載均衡算法，這也算有個切入點了不是？一個java類2000+行，理解一邊都耗費了大量的時間，說實話，別說修改框架源碼了，就是閱讀框架源碼至今也沒怎麼嘗試過。

今天下載了菊廠自帶的Rtool軟件商店，裡面基本有所有你需要而因沒有外網訪問權限而下不了的軟件。借此一次性下載了eclipse、intelliJ idea、sublime text 2、beyond_Compare和everything。beyond_Compare是用來比較文件的，everything用來索引文件，都是程序員的備用神器。

晚上按時回家了，welink裡公司員工們還在熱情地討論著問題，業務主管勇哥好像對於實習生按時下班這件事不是很大心裡去。他建議我加班？？？我能說什麼好呢？只能答應唄。慢慢地要開始體會到職場地殘酷了。。。

不過後來想想也對，實習生不應該更加賣力地表現自己嘛？也許是我沒有轉正的壓力吧，再加上公司明文規定不能讓實習生加班，以及身邊的菊廠同學基本上都不加班，所以我就認為不加班很合理。不過換位思考一下，每天按時上下班，誰敢把重要任務派給你？其實做我們這行的，沒有上下班概念，只有任務完成沒有的概念，這也許是我應該及時調整的觀念。

下定決心，明天吧負載均衡搞定，雖然應該最遲DDL是8月2號。早點寫完給師父提點建議沒什麼不好的。



#### 07-20 夜

**星期五 晴**

昨天觀念上做出調整後，今天早早就到了公司，吃過早飯後就到崗幹起活來。

可是當正入狀態時，9:30開始了週五的例會，計劃是開到11:30的，結果開到12:20。會議先是請部門DevOps相關專家來做作DevOps V1.4流程CR的解讀。這是熟悉公司研發整個流程的最好機會，也是第一次深知菊廠為了信息安全和隱私安全方面於作業流程上是花下大力氣的，其中一個“雙官隱私”制度就是為了隱私而設置的。然後是小組的工作梳理，我接下來的任務有兩個：

- Hive支持百萬級別分區的表，需要一個可靠性保持方案，遺留了兩個版本未解決。我和師父負責（師父說我主負責或者他主負責，到時候再看）
- MetaStore的負載均衡（我負責，昨天已經提過了）

中午折疊床到了，我已經把快遞小哥折磨地快瘋了。昨天打我電話我沒接到，今天打我電話我在開會，我剛坐下來吃飯他居然又很不巧地又打了個電話。小哥說：“老哥，你的快遞這麼大，我帶來帶去不方便啊😂”。然後吃完飯後，我打電話過去，他重新又送過來，為敬業的小哥敬禮！

下午剛開始工作，師父又讓我去參加培訓會議，是征帆哥講CalCite。這裡征帆哥是我第一次提到，征帆哥可以說是我師哥，他本科在南大金陵學院學的計算機，研究生在南大學的工商管理。但是我覺得他的IT技術是一流的，擄羊毛也很徹底，會深入代碼底層去研究開源框架。征帆哥是小組裡我看到除了實習生之外唯一一個使用IntelliJ IDEA的IDE，畢竟這個IDE除了學生免費外，其他人需要每年花費幾千RMB購買版權。後來征帆哥說這個帳號是網上找的，還有這操作？今天算是見識到了😊。

然後我就開始做起了MetaStore負載均衡，開始改Hive源碼，期間碰到了一些問題，下班後和師父交流了一下。交流後，我把問題綜合起來發給師父，他打算週六看看。今天他到點就回去了。

我們一起往回走，聊了很多。師父說我的實習工作是很有意義的，一般很少能接觸到這麼深層次的問題，因為這些問題如果不建立在菊廠的大環境下是不會碰到的，這點我非常同意，我也相信這次經歷一定會很有意義。

師父對南大鼓樓校區很熟悉，我一開始很奇怪，他不是東大的嘛？師父說他讀書時經常去南大🏊，南大游泳池是真的好，這點我也很同意。師父住在附近，一般他都騎小電驢上班，晚上他提出送我到地鐵站，因為方向相反，我婉拒了。

放假了，開心，明天要去練琴。



#### 07-23 夜

**星期一 晴**

今天上午把負載均衡的邏輯都完了，但是沒有測試環境，完全不知道正確性，這樣的白板開發效率十分低下，也很令人不爽。師父這幾天比較忙，他空下來時幫我們申請了外網訪問權限，是的，終於申請了。。。現在瀏覽網頁方便許多了，開發效率也相應地提高了。

中午，師父帶我和誠哥一起去吃飯，當然飯前也是師父出的😏，席間聊了一些私人問題，師父來自安徽宣城，他也了解我來自南通海門。他說他曾經有回去南通出差，坐快車都做了5個小時，車在如皋停了2個小時，說是為了給其他車讓道。說實話，沒通動車前，國內的交通狀況現在已經很難想像了，不禁感嘆時代變化得很快啊。

下午大部分時間用在了看書上，因為代碼沒有綠區環境可以自測，而師父又特別忙，所以我只能等會了。晚飯吃完後，我留下來等了會兒，師父在我要回去得時候走過來把綠區環境的測試過程告訴了我，很好，這樣明天才能繼續推進工作。

對了，晚飯後去N14四樓看了一下健身房，簡直了，我被N14的辦公環境驚呆了，太TM有感覺了。

![huawei_1](/photos/huawei-internship/huawei_1.JPG)

![huawei_2](/photos/huawei-internship/huawei_2.JPG)

應一哥要求，我今天特地去綠區拍了兩張照片，內部辦公區域是真的不敢拍，萬一被發現拍到屏幕或者行為可疑，後果是很嚴重的。

#### 07-24 夜

**星期二 晴**

今天一去公司就把maven下好了準備打包，然而不出意料，打包失敗了。後來師父說是工作環境問題，因為我們在綠區工作，而我改的代碼屬於黃區的代碼，所以必須在黃區打包，簡單得說，我改的是別人的代碼，本地環境又不支持。所以後來的事情就放在黃區工作環境申請上，也就是申請一個桌面雲。沒有桌面雲工作就不能推進，然而申請效率又十分低，加上師父工作比較忙，所以一天下來還是沒能測試成功。

接入黃區需要有一個菊廠自己生產的終端設備，通過這個設備可以登錄黃區桌面雲，當然通過此設備你的所有一舉一動都被監控了下來。一開始申請好了桌面雲，然後發現任何軟件都安裝不了，這裡又浪費了很多時間。後來資訊IT得知我申請的是會議雲不是辦公雲，會議雲不能安裝軟件，真是服了，怎麼會這麼麻煩？

中午吃飯的時候我和師父反映最近的工作太低效了，我希望能多分配點其他的任務，師父也答應了，不過他建議我先去吧FI_Hive的源碼看一下，順便把之前改的東西提交到Hive項目上去，說不定被開源項目接收了。

對了，師父在他的雲桌面裡把源碼項目試著打了包，居然抱錯了？？？源碼都報錯，那我明天估計又得有的受了。回去的路上師父發來消息說週五需要我去向小組成員講一下MetaStore的實現方式，然而我週五一整天都有培訓，那還玩啥呀。

不說了，睡覺。

#### 07-25 夜

**星期三 晴**

今天一早過去發現已經可以登錄辦公雲桌面了，說明今天地工作可以繼續推進。上午師父很耐心地教會我在黃區環境中下載源碼、編譯打包、填坑等等。我重新在新的雲桌面上下載安裝jdk、maven、git等工具，根據師父提供的注意事項一步步操作，最終把源碼編譯完成。整個編譯過程花費了7分鐘左右，生成文件大小居然達到了驚人的5個G！這是我第一次編譯這麼大的項目。期間碰到了一個問題一直無法解決，說找不到一個bash文件，後來知道是因為我直接在cmd上使用git，然後win換行符和Linux換行編碼不一樣而導致的，這也是為什麼業界都說win是最不友好的開發環境。。。然後使用git bash就解決了問題。

下午就開始把自己改的代碼替換進源碼中便宜，前期編譯錯誤不斷，畢竟是盲寫的代碼，不出問題此才叫奇怪。然後2點左右被叫去開會，開到接近5點，會議中為我另外安排了一項任務，需要和其他組的許田立功統完成，具體描述如下：

- 目前HIve表的權限僅僅支持32個角色，授予Hive表權限的時候，在hdfs層面授予ACL權限，hdfs限制只能有32個授權，開源的Apache Ranger是支持超過32個角色限制的。由於預計今年現網會到達100個角色，所以需要突破32個角色的限制。

經過討論，大家都發現這個問題還是很難解決的，許田立兄弟覺得一個人完成比較難，其他人也不接鍋，然後就派我去幫忙了。所以現在我身上已經同時背負了三個任務，還是蠻有挑戰性的。許兄提議網上有兩篇相關文章可以先看一下，hackershell.cn/?p=1055和[www.jianshu.com/p/d0bf6e77bb8f。](http://www.jianshu.com/p/d0bf6e77bb8f)。勇哥說讓我先看著，下回講給大家聽。

我們小組開會的時候，部門正在辦活動，而且就在隔壁辦公室，蹦噠嘣噠的，搞的我心裡巨癢癢。會議結束後看到誠哥發的espace說我怎麼不去？靠，我倒是想去啊。誠哥說給我留了根香蕉。我去拿香蕉的時候順便經過隔壁辦公室，大家都開始收攤了，不過還有很多水果沒吃，我就進去吃了個香蕉，居然被文秘抓著拍了張照。靠，為了根香蕉竟然出賣了色相，不值，那就再拿了個芒果走。去找誠哥時，這貨居然拿走了我出賣色相拿來的芒果？？？不是說好了讓我來拿香蕉的嘛？香蕉呢！！！

快飯點了，我抓緊時間改完了bug，然後打包成功，準備明天部署測試。

#### 07-26 夜

**星期四 晴**

今天加班到10點多，洗完澡吃完夜宵已經12點多了，很累，明天補吧。

#### 07-27 補

**星期五 晴**

全天培訓

#### 07-28 夜

**星期一 雷雨**

由於上週五的培訓，今天我要抓緊時間研究HDFS ACL 32 ENTRIES LIMITS問題。ACL是HDFS使用的相對於傳統POSIX權限模型“擴展組”“角色“。FusionInsight的角色管理是通過調用HDFS的權限管理插件更新NameNode的元數據紀錄。由於權限信息全部存放在HDFS的NameNode的元數據中，大量設置權限會消耗NameNode的內存。因此社區針對一個目錄，採用了最多設置32個權限的限制。問題的研究細節和疑問紀錄在筆記本中，週末記得整理技術博文。

一開始研究出了一個簡單的解決方案，就是直接去修改HDFS內核代碼，將硬編碼的限制數提高即可。這種方法官法極不支持，因為它會導致性能損失，但是也不失為一種方案，並且也有企業這麼實現過。但是考慮到需要修改內核代碼，我們最終捨棄。

然後立哥拿出了他前些天的研究方案，採用直接在外部調用組建中修改邏輯，如Hive中，將同樣權限的用戶組合併為一個復合名稱組，然後判斷權限時都解析復合名稱。

分—————割——————線

晚上正打算回去，吃飯的時候師父問還在嗎，看到消息時就有種不祥的預感，果不其然，加班需求到。

由於立哥明天要出差，他想今晚就把實現細節討論完，看樣子是要我實現了。。。過不過了。

但是，討論就討論吧，結構立哥說他有事得先出去一下，幾點回來不清楚，讓我等他。然後就開始了極為低效和不必要的加班，可能是實習生的成本低無所謂？退一萬步講，其實加班也很正常，若不是有這麼點敬業精神，我絕對不會留下來的，因為公司明令禁止實習生加班，而且又沒有工資。但是加班等人顯然是我不能接受的。

但是我也很給立哥面子，等他到8:30，然後我把問題交代給了師父，讓師父代我討論。

不願意加班也是有原因的，因為我回到家是有固定的生活計畫的，每天三個班小時固定的活動，一小時健身，一小時洗漱，一小時彈琴，半小時總結。如果加班，這些計劃會全被打亂，生活會一下子失去節奏。實習貿一方面為了學技能，一方面也是為了在工作和生活中找到平衡。我一直在努力維持著這種平衡，雖然有時會很難。

8:30領了夜宵就走了。結果地鐵坐到新街口才發現回來忘記打卡了。。。一時懊惱，結果地鐵又坐過了站，加班毀智商啊😣。

唯一的安慰就是領回來的免費夜宵了👇

![huawei_3](/photos/huawei-internship/huawei_3.JPG)